<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="attendance">

	<!-- 내 출퇴근 목록 페이징 -->
	<select id="getMyAttendanceCnt" resultType="int">
		SELECT COUNT(NO)
		FROM ATTENDANCE
		WHERE USER_NO=1
	</select>

	<!-- 내 출퇴근 목록 -->
	<select id="selectList" resultType="AttendanceVo">
		
		SELECT 
		    A.NO
		    ,A.USER_NO
		    ,A.CURRENT_NO
		    ,TO_CHAR(A.ENROLLDATE, 'YYYY-MM-DD') AS ENROLLDATE
		    ,NVL(TO_CHAR(A.CHECK_IN_TIME, 'HH24:MI:SS'), '00:00:00') AS CHECK_IN_TIME
		    ,NVL(TO_CHAR(A.CHECK_OUT_TIME, 'HH24:MI:SS'), '00:00:00') AS CHECK_OUT_TIME
		    ,TRUNC(
		    EXTRACT(DAY FROM A.PLUS_WORK_TIME)) || '일 ' ||
		    EXTRACT(HOUR FROM A.PLUS_WORK_TIME) || '시 ' ||
		    EXTRACT(MINUTE FROM A.PLUS_WORK_TIME) || '분 ' ||
		    EXTRACT(SECOND FROM A.PLUS_WORK_TIME) || '초' AS PLUS_WORK_TIME
		    ,TO_CHAR(A.CHECK_OUT_TIME - A.CHECK_IN_TIME + A.PLUS_WORK_TIME, 'HH24:MI:SS') AS TOTAL_WORK_TIME
		    ,A.OBJECTION_REASON
		    ,A.APPROVAL_STATUS
		    ,AC.TYPE AS TYPE
		    ,U.NAME AS NAME
		FROM ATTENDANCE A
		JOIN "USER" U
		ON A.USER_NO = U.NO
		JOIN ATTENDANCE_CURRENT AC
		ON A.CURRENT_NO = AC.NO
		WHERE U.NO = 1
		ORDER BY ENROLLDATE DESC
		
	</select>
	
	<!-- 휴가 요청 목록 페이징 -->
	<select id="getLeaveCnt" resultType="int">
		SELECT COUNT(NO)
		FROM LEAVE
		WHERE USER_NO = 1
	</select>
	
	<!-- 휴가 요청 목록 조회 -->
	<select id="selectLeaveList" resultType="com.kh.zoody.attendance.vo.LeaveVo">
		SELECT 
		    L.NO
		    ,L.USER_NO
		    ,L.LEAVE_NO
		    ,L.PROXY_NO
		    ,TO_CHAR(L.ENROLLDATE, 'YYYY-MM-DD') AS ENROLLDATE
		    ,L.REASON_CONTENT
		    ,TO_CHAR(L.START_TIME, 'YYYY-MM-DD') AS START_TIME
		    ,TO_CHAR(L.END_TIME, 'YYYY-MM-DD') AS END_TIME
		    ,L.STATUS
		    ,LT.TYPE
		FROM LEAVE L
		JOIN "USER" U
		ON U.NO = L.USER_NO
		JOIN LEAVE_TYPE LT
		ON LT.NO = L.LEAVE_NO
		WHERE U.NO = 1
		ORDER BY L.NO DESC
	</select>
  
</mapper>